{% extends 'base.html.twig' %}
{% block title %}{{ livre.titre }}{% endblock %}

{% block body %}
<div class="min-h-screen bg-[#F5F1E6] py-10 px-6">
    <div class="max-w-5xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col md:flex-row">
        
        <div class="md:w-1/3 bg-gray-100 relative min-h-[400px]">
            {% if livre.image %}
                <img src="{{ asset('uploads/images/' ~ livre.image) }}" class="w-full h-full object-cover">
            {% else %}
                <div class="flex items-center justify-center h-full text-gray-400">Pas d'image</div>
            {% endif %}
            
            {% if livre.stock > 0 %}
                <span class="absolute top-4 left-4 bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold">Stock: {{ livre.stock }}</span>
            {% else %}
                <span class="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold">Rupture</span>
            {% endif %}
        </div>

        <div class="md:w-2/3 p-8 flex flex-col">
            <h1 class="text-4xl font-bold text-[#8B5E3C] mb-2">{{ livre.titre }}</h1>
            <p class="text-3xl font-bold text-[#A67C52] mb-4">{{ livre.prix }} MAD</p>
            <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs w-max mb-6">{{ livre.categorie }}</span>
            
            <p class="text-gray-600 mb-8 flex-grow">{{ livre.description }}</p>

            <div class="mt-auto border-t pt-6">
                {# ADMIN #}
                {% if is_granted('ROLE_BIBLIOTHECAIRE') %}
                    <div class="mb-6 flex gap-3">
                        <a href="{{ path('app_livre_edit', {'id': livre.id}) }}" class="bg-yellow-500 text-white px-4 py-2 rounded font-bold">Modifier</a>
                        {{ include('livre/_delete_form.html.twig') }}
                    </div>
                {% endif %}

                {# USER #}
                {% if app.user %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        {% if livre.pdf %}
                            <a href="{{ path('app_livre_download', {'id': livre.id}) }}" target="_blank" class="bg-cyan-600 text-white py-3 rounded-lg font-bold text-center">üì• T√©l√©charger PDF</a>
                        {% endif %}

                        {% if livre.stock > 0 %}
                            <a href="{{ path('app_livre_emprunt', {'id': livre.id}) }}" class="bg-[#8B5E3C] text-white py-3 rounded-lg font-bold text-center">üìñ Emprunter</a>
                            <button class="border-2 border-[#8B5E3C] text-[#8B5E3C] py-3 rounded-lg font-bold">üõí Acheter</button>
                        {% else %}
                             <button disabled class="bg-gray-200 text-gray-400 py-3 rounded-lg font-bold cursor-not-allowed text-center">üö´ Stock √âpuis√©</button>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                        <a href="{{ path('app_login') }}" class="font-bold underline text-yellow-800">Connectez-vous</a> pour acc√©der aux livres.
                    </div>
                {% endif %}
            </div>
            
            <a href="{{ path('app_livre_index') }}" class="block mt-6 text-gray-400 hover:text-[#8B5E3C]">‚Üê Retour</a>
        </div>
    </div>
</div>
{% endblock %}