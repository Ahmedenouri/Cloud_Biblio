{% extends 'base.html.twig' %}

{% block title %}{{ livre.titre }} | BiblioHub{% endblock %}

{% block body %}
{# Fond beige clair #}
<div class="min-h-screen bg-[#F5F1E6] py-12 px-4 flex items-center justify-center">
    
    {# CARTE R√âDUITE (max-w-lg = environ 512px) #}
    <div class="w-full max-w-lg bg-white rounded-3xl shadow-xl overflow-hidden border border-[#8B5E3C]/10 transition-all duration-500 hover:shadow-2xl">
        
        {# --- SECTION IMAGE R√âDUITE --- #}
        <div class="w-full bg-gray-50 relative h-72"> {# Hauteur r√©duite de 96 √† 72 #}
            {% if livre.image %}
                <img src="{{ asset('uploads/images/' ~ livre.image) }}" class="w-full h-full object-cover" alt="{{ livre.titre }}">
            {% else %}
                <div class="flex items-center justify-center h-full text-[#8B5E3C]/30 italic bg-gray-50">
                    <span class="text-5xl">üìö</span>
                </div>
            {% endif %}
            
            {# Badge flottant plus petit #}
            <div class="absolute top-4 right-4">
                <span class="bg-[#8B5E3C] text-[#F5F1E6] px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider shadow-md">
                    {{ livre.categorie }}
                </span>
            </div>
        </div>

        {# --- SECTION INFOS & FORMULAIRE COMPACT --- #}
        <div class="p-6 sm:p-8">
            <div class="text-center mb-6">
                <h1 class="text-2xl font-extrabold text-[#8B5E3C] mb-2 leading-tight">{{ livre.titre }}</h1>
                <div class="flex justify-center items-center gap-4">
                    <span class="text-2xl font-black text-[#8B5E3C]">{{ livre.prix }} <small class="text-sm">MAD</small></span>
                    <div class="h-6 w-px bg-[#8B5E3C]/20"></div>
                    <span class="text-[#A67C52] text-xs font-bold uppercase tracking-tighter">
                        {% if livre.stock > 0 %} En Stock {% else %} √âpuis√© {% endif %}
                    </span>
                </div>
            </div>
            
            <div class="mb-8">
                <p class="text-gray-600 leading-snug text-sm italic font-serif text-center px-2 line-clamp-4">
                    "{{ livre.description }}"
                </p>
            </div>

            {% if app.user %}
                <div class="space-y-3">
                    
                    {% if livre.stock > 0 %}
                        {# ACHETER PAPIER - Bouton plus compact #}
                        <a href="{{ path('app_cart_add', {'id': livre.id, 'type': 'achat'}) }}" 
                           class="flex items-center justify-between bg-[#8B5E3C] hover:bg-[#A67C52] text-white px-6 py-3.5 rounded-xl font-bold transition-all duration-300 shadow-md transform hover:-translate-y-1 group text-sm">
                            <span class="flex items-center gap-2">
                                <span>üõí</span> Acheter
                            </span>
                            <span class="bg-white/10 px-2 py-0.5 rounded text-xs">{{ livre.prix }} MAD</span>
                        </a>

                        {# LOUER - Bouton plus compact #}
                        {% set prixLocation = livre.prix * 0.10 %}
                        <a href="{{ path('app_cart_add', {'id': livre.id, 'type': 'emprunt'}) }}" 
                           class="flex items-center justify-between border-2 border-[#8B5E3C] text-[#8B5E3C] hover:bg-[#8B5E3C] hover:text-white px-6 py-3.5 rounded-xl font-bold transition-all duration-300 transform hover:-translate-y-1 text-sm">
                            <span class="flex items-center gap-2">
                                <span>üìñ</span> Louer (5j)
                            </span>
                            <span class="bg-[#8B5E3C]/10 px-2 py-0.5 rounded text-xs">{{ prixLocation|number_format(2) }} MAD</span>
                        </a>
                    {% endif %}

                    {# OPTION PDF - Bouton plus compact #}
                    {% if livre.pdf %}
                        <a href="{{ path('app_cart_add', {'id': livre.id, 'type': 'pdf'}) }}" 
                           class="flex items-center justify-between bg-[#A67C52]/5 border border-dashed border-[#A67C52] text-[#A67C52] hover:bg-[#A67C52] hover:text-white px-6 py-3.5 rounded-xl font-bold transition-all duration-300 text-sm group">
                            <span class="flex items-center gap-2">
                                <span>üì±</span> Version PDF
                            </span>
                            <span class="bg-[#A67C52]/10 group-hover:bg-white/20 px-2 py-0.5 rounded text-xs">{{ livre.prixPdf }} MAD</span>
                        </a>
                    {% endif %}
                </div>
            {% else %}
                <div class="bg-[#F5F1E6] border border-[#8B5E3C]/10 p-4 rounded-xl text-center text-xs">
                    <p class="text-[#8B5E3C]">
                        Veuillez vous <a href="{{ path('app_login') }}" class="font-bold underline hover:text-[#A67C52]">connecter</a> pour commander.
                    </p>
                </div>
            {% endif %}

            {# ACTIONS STAFF DISCRETES #}
            {% if is_granted('ROLE_BIBLIOTHECAIRE') %}
                <div class="mt-8 pt-4 border-t border-gray-100 flex justify-center">
                    <a href="{{ path('app_livre_edit', {'id': livre.id}) }}" class="text-[#8B5E3C]/30 hover:text-[#8B5E3C] text-[10px] font-black uppercase tracking-widest transition">
                        ‚úèÔ∏è Modifier la fiche
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{# Bouton de retour en bas de page #}
<div class="pb-10 bg-[#F5F1E6] text-center">
    <a href="{{ path('app_home') }}" class="text-[#8B5E3C] hover:text-[#A67C52] font-bold text-sm inline-flex items-center gap-2 transition-transform hover:-translate-x-1">
        ‚Üê Retour au catalogue
    </a>
</div>
{% endblock %}